# Basic Spring Batch Application

- 이론은 나중에 살펴보고, 우선 스프링배치를 실행해보자. 
- 우리는 스프링배치 중 Tasklet이라는 것을 만들고 스프링 배치를 수행해 볼 것이다. 

## 프로젝트 준비

- 이전 아티클에서 만든 스프링 배치를 그대로 이용할 것이다. 
- 참고로 우리는 스프링 배치 3.0 이상 버젼을 이용하므로 @EnableBatchProcessing 이 필요하지 않다. 

## 기본 배치 어플리케이션 

- [01.InitSpringBatch](./01.InitSpringBatch.md) 에서 생성한 스프링 배치 어플리케이션을 그대로 이용할 것이다. 
- 다음과 같은 과정을 거치게 된다. 
  - 1. Tasklet 구현체를 생성한다. 
  - 2. @Configuration을 통해서 생성할 배치 빈을 스프링에 등록한다. 
  - 3. Job, Step 을 생성하고 빈에 등록한다. 
  - 4. 실행 결과를 확인한다. 

### Tasklet 구현체 생성하기

- GreetingTask.kt 파일을 생성하고 다음과 같이 작성한다. 

```kotlin
package com.schooldevops.spring_batch.jobs.task01

import org.slf4j.Logger
import org.slf4j.LoggerFactory
import org.springframework.batch.core.StepContribution
import org.springframework.batch.core.scope.context.ChunkContext
import org.springframework.batch.core.step.tasklet.Tasklet
import org.springframework.batch.repeat.RepeatStatus
import org.springframework.beans.factory.InitializingBean

class GreetingTask : Tasklet, InitializingBean {
    private val log: Logger = LoggerFactory.getLogger(GreetingTask::class.java)

    override fun execute(contribution: StepContribution, chunkContext: ChunkContext): RepeatStatus? {
        log.info("------------------ Task Execute -----------------");
        log.info("GreetingTask: {}, {}", contribution, chunkContext);
        return RepeatStatus.FINISHED;
    }

    override fun afterPropertiesSet() {
        log.info("----------------- After Properites Sets() --------------");
    }
}
```

- 보는바와 같이 Tasklet과 InitializeBean 인터페이스를 구현한다.
- Tasklet은 execute 메소드를 구현해야한다.
- InitializeBean은 afterPropertiesSet 메소드를 구현해야한다. 

- execute:
  - execute메소드는 StepContributioin 과 ChunkContext 를 파라미터로 받는다. 
  - 최종적으로 RepeatStatus 를 반환하며 이 값은 다음과 같다. 
    - FINISHED: 태스크릿이 종료되었음을 나타낸다. 
    - CONTINUABLE: 계속해서 태스크를 수행하도록한다. 
    - continueIf(condition): 조건에 따라 종료할지 지속할지 결정하는 메소드에 따라 종료/지속을 결정한다. 
- afterPropertiesSet:
  - 태스크를 수해할때 프로퍼티를 설정하고 난 뒤에 수행되는 메소드이다. 
  - 사실상 없어도 된다. 

### @Configuration을 통해서 생성할 배치 빈을 스프링에 등록

- 스프링부트는 @Configuration을 통해서 빈을 등록할 설정을 할 수 있도록 어노테이션을 제공한다. 
- BasicTaskJobConfiguration.kt 파일을 다음과 같이 작성한다. 

```kotlin
package com.schooldevops.spring_batch.jobs.task01

import org.slf4j.Logger
import org.slf4j.LoggerFactory
import org.springframework.batch.core.Job
import org.springframework.batch.core.Step
import org.springframework.batch.core.job.builder.JobBuilder
import org.springframework.batch.core.launch.support.RunIdIncrementer
import org.springframework.batch.core.repository.JobRepository
import org.springframework.batch.core.step.builder.StepBuilder
import org.springframework.batch.core.step.tasklet.Tasklet
import org.springframework.beans.factory.annotation.Autowired
import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration
import org.springframework.transaction.PlatformTransactionManager

@Configuration
class BasicTaskJobConfiguration {

    ... 비워두기
}
```

- 이를 통해서 빈을 등록할 수 있도록 스프링 부트가 부트업 되면 @Configuration 을 찾고 빈을 등록할 작업을 수행한다. 

### Job, Step 을 생성하고 빈에 등록

- 이제 Job과 Step을 생성하고 빈으로 등록해보자. 
- BasicTaskJobConfiguration.kt 파일내부를 다음과 같이 작성하여 완전한 소스를 만들자. 

```kotlin
package com.schooldevops.spring_batch.jobs.task01

import org.slf4j.Logger
import org.slf4j.LoggerFactory
import org.springframework.batch.core.Job
import org.springframework.batch.core.Step
import org.springframework.batch.core.job.builder.JobBuilder
import org.springframework.batch.core.launch.support.RunIdIncrementer
import org.springframework.batch.core.repository.JobRepository
import org.springframework.batch.core.step.builder.StepBuilder
import org.springframework.batch.core.step.tasklet.Tasklet
import org.springframework.beans.factory.annotation.Autowired
import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration
import org.springframework.transaction.PlatformTransactionManager

@Configuration
class BasicTaskJobConfiguration {

    private val log: Logger = LoggerFactory.getLogger(BasicTaskJobConfiguration::class.java)

    @Autowired
    private lateinit var transactionManager: PlatformTransactionManager


    fun greetingTasklet(): Tasklet {
        return GreetingTask()
    }

    @Bean
    fun step(jobRepository: JobRepository): Step {
        log.info("------------------ Init myStep -----------------")

        return StepBuilder("myStep", jobRepository)
            .tasklet(greetingTasklet(), transactionManager)
            .build()
    }

    @Bean
    fun myJob(step: Step, jobRepository: JobRepository): Job {
        log.info("------------------ Init myJob -----------------")
        return JobBuilder("MY_JOB", jobRepository)
            .incrementer(RunIdIncrementer())
            .start(step)
            .build()
    }
}

```

- 이전에 생성한 Tasklet도 빈으로 등록했다. 

```kotlin
    @Bean
    fun step(jobRepository: JobRepository): Step {
        log.info("------------------ Init myStep -----------------")

        return StepBuilder("myStep", jobRepository)
            .tasklet(greetingTasklet(), transactionManager)
            .build()
    }
```

- 위 코드는 step 빈을 등록했다. JobRepository와 PlatformTransactionManager 를 파라미터로 받는다. 
- 스프랭 배치는 보통 데이터소스와 함께 작업하므로 PlatformTransactionManager이 필요하다. 
- StepBuilder를 생성하고, 스텝의 이름을 myStep으로 지정했다. 
- 그리고 이 스텝은 jobRepository에 등록된다. 
- tasklet을 스텝에 추가하고, greetingTasklet() 을 통해서 스탭내 태스크릿을 주입했다. 
- build를 통해서 스텝을 생성하고 빈으로 등록하도록 return한다. . 

```kotlin

    @Bean
    fun myJob(step: Step, jobRepository: JobRepository): Job {
        log.info("------------------ Init myJob -----------------")
        return JobBuilder("MY_JOB", jobRepository)
            .incrementer(RunIdIncrementer())
            .start(step)
            .build()
    }
```

- Job을 생성한다. Job은 Step이 필요하며, JobRepository 역시 필요하다. 
- Job은 JobRepository에 등록되게 된다. 
- JobBuilder를 동해서 이름이 myJob인 잡을 생성했다. 
- incrementer은 잡이 지속적으로 실행될때, 잡의 유니크성을 구분할 수 있는 방법을 설정한다. 
- RunIdIncrementer는 잡의 아이디를 실행할때 지속적으로 증가시키면서 유니크한 잡을 실행하게 된다. 
- start(step) 을 통해서 잡의 시작 포인트를 잡는다. 처음시작하는 스텝은 우리가 파라미터로 받은 step을 등록했다. 
- build를 통해서 잡생성하고 빈으로 등록하도록 return한다. 

### 실행하기 

- 이제 실행하고 어떤 결과가 나왓는지 살펴보자. 

```sh
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.2)

... 생략
2025-02-07 08:33:33 INFO  c.s.s.j.t.BasicTaskJobConfiguration - ------------------ Init myStep -----------------
2025-02-07 08:33:33 INFO  c.s.s.j.t.BasicTaskJobConfiguration - ------------------ Init myJob -----------------
... 생략
2025-02-07 08:33:33 DEBUG o.s.jdbc.datasource.init.ScriptUtils - 0 returned as update count for SQL: INSERT INTO BATCH_JOB_SEQ (ID, UNIQUE_KEY) select * from (select 0 as ID, '0' as UNIQUE_KEY) as tmp where not exists(select * from BATCH_JOB_SEQ)
2025-02-07 08:33:33 DEBUG o.s.jdbc.datasource.init.ScriptUtils - Executed SQL script from class path resource [org/springframework/batch/core/schema-mysql.sql] in 288 ms.
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - After adding stats (total=5/10, idle=5/10, active=0, waiting=0)
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'jobRepository'
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Attempting to create/setup new connection (ec06eb8e-e5fa-4c0d-bdba-6706d47ea8c2)
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration$SpringBootBatchConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration$SpringBootBatchConfiguration' via constructor to bean named 'dataSource'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration$SpringBootBatchConfiguration' via constructor to bean named 'transactionManager'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration$SpringBootBatchConfiguration' via constructor to bean named 'spring.batch-org.springframework.boot.autoconfigure.batch.BatchProperties'
2025-02-07 08:33:33 DEBUG o.s.jdbc.datasource.DataSourceUtils - Fetching JDBC Connection from DataSource
2025-02-07 08:33:33 DEBUG o.s.t.i.NameMatchTransactionAttributeSource - Adding transactional method [*] with attribute [PROPAGATION_REQUIRED,ISOLATION_DEFAULT]
2025-02-07 08:33:33 DEBUG o.s.t.i.NameMatchTransactionAttributeSource - Adding transactional method [create*] with attribute [PROPAGATION_REQUIRES_NEW,ISOLATION_SERIALIZABLE]
2025-02-07 08:33:33 DEBUG o.s.t.i.NameMatchTransactionAttributeSource - Adding transactional method [getLastJobExecution*] with attribute [PROPAGATION_REQUIRES_NEW,ISOLATION_SERIALIZABLE]
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Established new connection (ec06eb8e-e5fa-4c0d-bdba-6706d47ea8c2)
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@372850
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'step' via factory method to bean named 'jobRepository'
2025-02-07 08:33:33 INFO  c.s.s.j.t.BasicTaskJobConfiguration - ------------------ Init myStep -----------------
2025-02-07 08:33:33 DEBUG i.m.c.u.i.l.InternalLoggerFactory - Using SLF4J as the default logging framework
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'myJob'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'myJob' via factory method to bean named 'step'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'myJob' via factory method to bean named 'jobRepository'
2025-02-07 08:33:33 INFO  c.s.s.j.t.BasicTaskJobConfiguration - ------------------ Init myJob -----------------
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - After adding stats (total=6/10, idle=6/10, active=0, waiting=0)
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Attempting to create/setup new connection (ee679e3f-11ca-4959-99df-c185b2422ea9)
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.AutoConfigurationPackages'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'spring.jmx-org.springframework.boot.autoconfigure.jmx.JmxProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration' via constructor to bean named 'spring.jmx-org.springframework.boot.autoconfigure.jmx.JmxProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'mbeanExporter'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'objectNamingStrategy'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'mbeanExporter' via factory method to bean named 'objectNamingStrategy'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'mbeanExporter' via factory method to bean named 'org.springframework.beans.factory.support.DefaultListableBeanFactory@65004ff6'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'mbeanServer'
2025-02-07 08:33:33 DEBUG o.s.jmx.support.JmxUtils - Found MBeanServer: com.sun.jmx.mbeanserver.JmxMBeanServer@727803de
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.context.properties.EnableConfigurationPropertiesRegistrar.methodValidationExcludeFilter'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'springApplicationAdminRegistrar'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'springApplicationAdminRegistrar' via factory method to bean named 'environment'
2025-02-07 08:33:33 DEBUG o.s.b.a.SpringApplicationAdminMXBeanRegistrar$SpringApplicationAdmin - Application Admin MBean registered with name 'org.springframework.boot:type=Admin,name=SpringApplication'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.availability.ApplicationAvailabilityAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'applicationAvailability'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.jdbc.metadata.DataSourcePoolMetadataProvidersConfiguration$HikariPoolDataSourceMetadataProviderConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'hikariPoolDataSourceMetadataProvider'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.jdbc.metadata.DataSourcePoolMetadataProvidersConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'spring.datasource-org.springframework.boot.autoconfigure.jdbc.DataSourceProperties'
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Established new connection (ee679e3f-11ca-4959-99df-c185b2422ea9)
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@27930f57
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration$EnableTransactionManagementConfiguration$CglibAutoProxyConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration$EnableTransactionManagementConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration$TransactionTemplateConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'transactionTemplate'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'transactionTemplate' via factory method to bean named 'transactionManager'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.batch.core.configuration.support.ScopeConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'jobLauncher'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'jobLauncher' via factory method to bean named 'jobRepository'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'jobExplorer'
2025-02-07 08:33:33 DEBUG o.s.t.i.NameMatchTransactionAttributeSource - Adding transactional method [find*] with attribute [PROPAGATION_SUPPORTS,ISOLATION_DEFAULT]
2025-02-07 08:33:33 DEBUG o.s.t.i.NameMatchTransactionAttributeSource - Adding transactional method [get*] with attribute [PROPAGATION_SUPPORTS,ISOLATION_DEFAULT]
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'jobRegistry'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'jobOperator'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'jobOperator' via factory method to bean named 'jobRepository'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'jobOperator' via factory method to bean named 'jobExplorer'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'jobOperator' via factory method to bean named 'jobRegistry'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'jobOperator' via factory method to bean named 'jobLauncher'
2025-02-07 08:33:33 DEBUG o.s.t.i.NameMatchTransactionAttributeSource - Adding transactional method [stop*] with attribute [PROPAGATION_REQUIRED,ISOLATION_DEFAULT]
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'jobRegistrySmartInitializingSingleton'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'jobRegistrySmartInitializingSingleton' via factory method to bean named 'jobRegistry'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'jobLauncherApplicationRunner'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'jobLauncherApplicationRunner' via factory method to bean named 'jobLauncher'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'jobLauncherApplicationRunner' via factory method to bean named 'jobExplorer'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'jobLauncherApplicationRunner' via factory method to bean named 'jobRepository'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'jobLauncherApplicationRunner' via factory method to bean named 'spring.batch-org.springframework.boot.autoconfigure.batch.BatchProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'jobExecutionExitCodeGenerator'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.context.LifecycleAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'lifecycleProcessor'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'spring.lifecycle-org.springframework.boot.autoconfigure.context.LifecycleProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'lifecycleProcessor' via factory method to bean named 'spring.lifecycle-org.springframework.boot.autoconfigure.context.LifecycleProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'spring.info-org.springframework.boot.autoconfigure.info.ProjectInfoProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration' via constructor to bean named 'spring.info-org.springframework.boot.autoconfigure.info.ProjectInfoProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.jdbc.JdbcTemplateConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'jdbcTemplate'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'spring.jdbc-org.springframework.boot.autoconfigure.jdbc.JdbcProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'jdbcTemplate' via factory method to bean named 'dataSource'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'jdbcTemplate' via factory method to bean named 'spring.jdbc-org.springframework.boot.autoconfigure.jdbc.JdbcProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.jdbc.NamedParameterJdbcTemplateConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'namedParameterJdbcTemplate'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'namedParameterJdbcTemplate' via factory method to bean named 'jdbcTemplate'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.jdbc.JdbcClientAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'jdbcClient'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'jdbcClient' via factory method to bean named 'namedParameterJdbcTemplate'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.sql.init.SqlInitializationAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.ssl.SslAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'spring.ssl-org.springframework.boot.autoconfigure.ssl.SslProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'org.springframework.boot.autoconfigure.ssl.SslAutoConfiguration' via constructor to bean named 'org.springframework.context.annotation.AnnotationConfigApplicationContext@304b9f1a'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'org.springframework.boot.autoconfigure.ssl.SslAutoConfiguration' via constructor to bean named 'spring.ssl-org.springframework.boot.autoconfigure.ssl.SslProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'fileWatcher'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'sslPropertiesSslBundleRegistrar'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'sslPropertiesSslBundleRegistrar' via factory method to bean named 'fileWatcher'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'sslBundleRegistry'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.task.TaskExecutorConfigurations$ThreadPoolTaskExecutorBuilderConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'threadPoolTaskExecutorBuilder'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'spring.task.execution-org.springframework.boot.autoconfigure.task.TaskExecutionProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'threadPoolTaskExecutorBuilder' via factory method to bean named 'spring.task.execution-org.springframework.boot.autoconfigure.task.TaskExecutionProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.task.TaskExecutorConfigurations$SimpleAsyncTaskExecutorBuilderConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'org.springframework.boot.autoconfigure.task.TaskExecutorConfigurations$SimpleAsyncTaskExecutorBuilderConfiguration' via constructor to bean named 'spring.task.execution-org.springframework.boot.autoconfigure.task.TaskExecutionProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'simpleAsyncTaskExecutorBuilder'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.task.TaskExecutorConfigurations$TaskExecutorConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.task.TaskSchedulingConfigurations$ThreadPoolTaskSchedulerBuilderConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'threadPoolTaskSchedulerBuilder'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'spring.task.scheduling-org.springframework.boot.autoconfigure.task.TaskSchedulingProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'threadPoolTaskSchedulerBuilder' via factory method to bean named 'spring.task.scheduling-org.springframework.boot.autoconfigure.task.TaskSchedulingProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.task.TaskSchedulingConfigurations$SimpleAsyncTaskSchedulerBuilderConfiguration'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'org.springframework.boot.autoconfigure.task.TaskSchedulingConfigurations$SimpleAsyncTaskSchedulerBuilderConfiguration' via constructor to bean named 'spring.task.scheduling-org.springframework.boot.autoconfigure.task.TaskSchedulingProperties'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'simpleAsyncTaskSchedulerBuilder'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'org.springframework.boot.autoconfigure.task.TaskSchedulingAutoConfiguration'
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - After adding stats (total=7/10, idle=7/10, active=0, waiting=0)
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Attempting to create/setup new connection (3a145e3c-cbcc-46d6-89f5-315afafe4416)
2025-02-07 08:33:33 DEBUG o.s.j.e.a.AnnotationMBeanExporter - Registering beans for JMX exposure on startup
2025-02-07 08:33:33 DEBUG o.s.j.e.a.AnnotationMBeanExporter - Auto-detecting user-defined JMX MBeans
2025-02-07 08:33:33 DEBUG o.s.j.e.a.AnnotationMBeanExporter - Bean with name 'hikariConfig' has been autodetected for JMX exposure
2025-02-07 08:33:33 DEBUG o.s.j.e.a.AnnotationMBeanExporter - Bean with name 'dataSource' has been autodetected for JMX exposure
2025-02-07 08:33:33 DEBUG o.s.j.e.a.AnnotationMBeanExporter - Located MBean 'hikariConfig': registering with JMX server as MBean [com.zaxxer.hikari:name=hikariConfig,type=HikariConfig]
2025-02-07 08:33:33 DEBUG o.s.j.e.a.AnnotationMBeanExporter - Located MBean 'dataSource': registering with JMX server as MBean [com.zaxxer.hikari:name=dataSource,type=HikariDataSource]
2025-02-07 08:33:33 DEBUG o.s.b.c.c.s.JobRegistrySmartInitializingSingleton - Registering job: MY_JOB
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating shared instance of singleton bean 'applicationTaskExecutor'
2025-02-07 08:33:33 DEBUG o.s.b.f.s.DefaultListableBeanFactory - Autowiring by type from bean name 'applicationTaskExecutor' via factory method to bean named 'threadPoolTaskExecutorBuilder'
2025-02-07 08:33:33 DEBUG o.s.s.c.ThreadPoolTaskExecutor - Initializing ExecutorService 'applicationTaskExecutor'
2025-02-07 08:33:33 DEBUG o.s.c.s.DefaultLifecycleProcessor - Starting beans in phase -2147483647
2025-02-07 08:33:33 DEBUG o.s.c.s.DefaultLifecycleProcessor - Successfully started bean 'springBootLoggingLifecycle'
2025-02-07 08:33:33 DEBUG o.s.c.s.DefaultLifecycleProcessor - Starting beans in phase 1073741823
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Established new connection (3a145e3c-cbcc-46d6-89f5-315afafe4416)
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@5b114d23
2025-02-07 08:33:33 INFO  c.s.s.SpringBatchApplicationKt - Started SpringBatchApplicationKt in 1.218 seconds (process running for 2.524)
2025-02-07 08:33:33 DEBUG o.s.b.a.ApplicationAvailabilityBean - Application availability state LivenessState changed to CORRECT
2025-02-07 08:33:33 INFO  o.s.b.a.b.JobLauncherApplicationRunner - Running default command line with: []
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Creating new transaction with name [org.springframework.batch.core.repository.support.SimpleJobRepository.isJobInstanceExists]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Acquired Connection [HikariProxyConnection@1959623055 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] for JDBC transaction
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Switching JDBC Connection [HikariProxyConnection@1959623055 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to manual commit
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT JOB_INSTANCE_ID, JOB_NAME
FROM BATCH_JOB_INSTANCE
WHERE JOB_NAME = ?
 and JOB_KEY = ?]
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Initiating transaction commit
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Committing JDBC transaction on Connection [HikariProxyConnection@1959623055 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551]
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Releasing JDBC Connection [HikariProxyConnection@1959623055 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] after transaction
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT JOB_INSTANCE_ID, JOB_NAME
FROM BATCH_JOB_INSTANCE I1
WHERE I1.JOB_NAME = ? AND I1.JOB_INSTANCE_ID = (SELECT MAX(I2.JOB_INSTANCE_ID) FROM BATCH_JOB_INSTANCE I2 WHERE I2.JOB_NAME = ?)
]
2025-02-07 08:33:33 DEBUG o.s.jdbc.datasource.DataSourceUtils - Fetching JDBC Connection from DataSource
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - After adding stats (total=8/10, idle=7/10, active=1, waiting=0)
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Attempting to create/setup new connection (014c3873-9c5d-4519-8ad3-f7210448532f)
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT JOB_EXECUTION_ID, START_TIME, END_TIME, STATUS, EXIT_CODE, EXIT_MESSAGE, CREATE_TIME, LAST_UPDATED, VERSION
FROM BATCH_JOB_EXECUTION E
WHERE JOB_INSTANCE_ID = ? AND JOB_EXECUTION_ID IN (SELECT MAX(JOB_EXECUTION_ID) FROM BATCH_JOB_EXECUTION E2 WHERE E2.JOB_INSTANCE_ID = ?)
]
2025-02-07 08:33:33 DEBUG o.s.jdbc.datasource.DataSourceUtils - Fetching JDBC Connection from DataSource
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT JOB_EXECUTION_ID, PARAMETER_NAME, PARAMETER_TYPE, PARAMETER_VALUE, IDENTIFYING
FROM BATCH_JOB_EXECUTION_PARAMS
WHERE JOB_EXECUTION_ID = ?
]
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT JI.JOB_INSTANCE_ID, JOB_NAME, JOB_KEY, JI.VERSION
FROM BATCH_JOB_INSTANCE JI, BATCH_JOB_EXECUTION JE
WHERE JOB_EXECUTION_ID = ? AND JI.JOB_INSTANCE_ID = JE.JOB_INSTANCE_ID
]
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT STEP_EXECUTION_ID, STEP_NAME, START_TIME, END_TIME, STATUS, COMMIT_COUNT, READ_COUNT, FILTER_COUNT, WRITE_COUNT, EXIT_CODE, EXIT_MESSAGE, READ_SKIP_COUNT, WRITE_SKIP_COUNT, PROCESS_SKIP_COUNT, ROLLBACK_COUNT, LAST_UPDATED, VERSION, CREATE_TIME
FROM BATCH_STEP_EXECUTION
WHERE JOB_EXECUTION_ID = ?
 ORDER BY STEP_EXECUTION_ID]
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT SHORT_CONTEXT, SERIALIZED_CONTEXT
FROM BATCH_JOB_EXECUTION_CONTEXT
WHERE JOB_EXECUTION_ID = ?
]
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Established new connection (014c3873-9c5d-4519-8ad3-f7210448532f)
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@e628946
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT SHORT_CONTEXT, SERIALIZED_CONTEXT
FROM BATCH_STEP_EXECUTION_CONTEXT
WHERE STEP_EXECUTION_ID = ?
]
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Creating new transaction with name [org.springframework.batch.core.repository.support.SimpleJobRepository.getLastJobExecution]: PROPAGATION_REQUIRES_NEW,ISOLATION_SERIALIZABLE
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Acquired Connection [HikariProxyConnection@494874378 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] for JDBC transaction
2025-02-07 08:33:33 DEBUG o.s.jdbc.datasource.DataSourceUtils - Changing isolation level of JDBC Connection [HikariProxyConnection@494874378 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to 8
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Switching JDBC Connection [HikariProxyConnection@494874378 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to manual commit
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT JOB_INSTANCE_ID, JOB_NAME
FROM BATCH_JOB_INSTANCE
WHERE JOB_NAME = ?
 and JOB_KEY = ?]
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Initiating transaction commit
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Committing JDBC transaction on Connection [HikariProxyConnection@494874378 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551]
2025-02-07 08:33:33 DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting isolation level of JDBC Connection [HikariProxyConnection@494874378 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to 4
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Releasing JDBC Connection [HikariProxyConnection@494874378 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] after transaction
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Creating new transaction with name [org.springframework.batch.core.repository.support.SimpleJobRepository.createJobExecution]: PROPAGATION_REQUIRES_NEW,ISOLATION_SERIALIZABLE
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Acquired Connection [HikariProxyConnection@506046490 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] for JDBC transaction
2025-02-07 08:33:33 DEBUG o.s.jdbc.datasource.DataSourceUtils - Changing isolation level of JDBC Connection [HikariProxyConnection@506046490 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to 8
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Switching JDBC Connection [HikariProxyConnection@506046490 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to manual commit
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT JOB_INSTANCE_ID, JOB_NAME
FROM BATCH_JOB_INSTANCE
WHERE JOB_NAME = ?
 and JOB_KEY = ?]
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT JOB_INSTANCE_ID, JOB_NAME
FROM BATCH_JOB_INSTANCE
WHERE JOB_NAME = ?
 and JOB_KEY = ?]
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - After adding stats (total=9/10, idle=7/10, active=2, waiting=0)
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Attempting to create/setup new connection (d9c459e5-a798-42ed-97a7-ccff2e500a9f)
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL update
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [INSERT INTO BATCH_JOB_INSTANCE(JOB_INSTANCE_ID, JOB_NAME, JOB_KEY, VERSION)
	VALUES (?, ?, ?, ?)
]
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Established new connection (d9c459e5-a798-42ed-97a7-ccff2e500a9f)
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@4b674abf
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL update
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [INSERT INTO BATCH_JOB_EXECUTION(JOB_EXECUTION_ID, JOB_INSTANCE_ID, START_TIME, END_TIME, STATUS, EXIT_CODE, EXIT_MESSAGE, VERSION, CREATE_TIME, LAST_UPDATED)
	VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
]
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing SQL batch update [INSERT INTO BATCH_JOB_EXECUTION_PARAMS(JOB_EXECUTION_ID, PARAMETER_NAME, PARAMETER_TYPE, PARAMETER_VALUE, IDENTIFYING)
	VALUES (?, ?, ?, ?, ?)
] with a batch size of 100
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [INSERT INTO BATCH_JOB_EXECUTION_PARAMS(JOB_EXECUTION_ID, PARAMETER_NAME, PARAMETER_TYPE, PARAMETER_VALUE, IDENTIFYING)
	VALUES (?, ?, ?, ?, ?)
]
2025-02-07 08:33:33 DEBUG o.s.jdbc.support.JdbcUtils - JDBC driver supports batch updates
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL update
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [INSERT INTO BATCH_JOB_EXECUTION_CONTEXT (SHORT_CONTEXT, SERIALIZED_CONTEXT, JOB_EXECUTION_ID)
	VALUES(?, ?, ?)
]
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Initiating transaction commit
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Committing JDBC transaction on Connection [HikariProxyConnection@506046490 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551]
2025-02-07 08:33:33 DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting isolation level of JDBC Connection [HikariProxyConnection@506046490 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to 4
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Releasing JDBC Connection [HikariProxyConnection@506046490 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] after transaction
2025-02-07 08:33:33 INFO  o.s.b.c.l.s.TaskExecutorJobLauncher - Job: [SimpleJob: [name=MY_JOB]] launched with the following parameters: [{'run.id':'{value=2, type=class java.lang.Long, identifying=true}'}]
2025-02-07 08:33:33 DEBUG o.s.batch.core.job.AbstractJob - Job execution starting: JobExecution: id=2, version=0, startTime=null, endTime=null, lastUpdated=2025-02-07T08:33:33.931589, status=STARTING, exitStatus=exitCode=UNKNOWN;exitDescription=, job=[JobInstance: id=2, version=0, Job=[MY_JOB]], jobParameters=[{'run.id':'{value=2, type=class java.lang.Long, identifying=true}'}]
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Creating new transaction with name [org.springframework.batch.core.repository.support.SimpleJobRepository.update]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Acquired Connection [HikariProxyConnection@1385061944 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] for JDBC transaction
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Switching JDBC Connection [HikariProxyConnection@1385061944 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to manual commit
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT VERSION
FROM BATCH_JOB_EXECUTION
WHERE JOB_EXECUTION_ID=?
]
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - After adding stats (total=10/10, idle=9/10, active=1, waiting=0)
2025-02-07 08:33:33 DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Connection not added, stats (total=10/10, idle=9/10, active=1, waiting=0)
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT COUNT(*)
FROM BATCH_JOB_EXECUTION
WHERE JOB_EXECUTION_ID = ?
]
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL update
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [UPDATE BATCH_JOB_EXECUTION
SET START_TIME = ?, END_TIME = ?,  STATUS = ?, EXIT_CODE = ?, EXIT_MESSAGE = ?, VERSION = ?, CREATE_TIME = ?, LAST_UPDATED = ?
WHERE JOB_EXECUTION_ID = ? AND VERSION = ?
]
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Initiating transaction commit
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Committing JDBC transaction on Connection [HikariProxyConnection@1385061944 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551]
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Releasing JDBC Connection [HikariProxyConnection@1385061944 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] after transaction
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Creating new transaction with name [org.springframework.batch.core.repository.support.SimpleJobRepository.getLastStepExecution]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Acquired Connection [HikariProxyConnection@41792607 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] for JDBC transaction
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Switching JDBC Connection [HikariProxyConnection@41792607 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to manual commit
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT SE.STEP_EXECUTION_ID, SE.STEP_NAME, SE.START_TIME, SE.END_TIME, SE.STATUS, SE.COMMIT_COUNT, SE.READ_COUNT, SE.FILTER_COUNT, SE.WRITE_COUNT, SE.EXIT_CODE, SE.EXIT_MESSAGE, SE.READ_SKIP_COUNT, SE.WRITE_SKIP_COUNT, SE.PROCESS_SKIP_COUNT, SE.ROLLBACK_COUNT, SE.LAST_UPDATED, SE.VERSION, SE.CREATE_TIME, JE.JOB_EXECUTION_ID, JE.START_TIME, JE.END_TIME, JE.STATUS, JE.EXIT_CODE, JE.EXIT_MESSAGE, JE.CREATE_TIME, JE.LAST_UPDATED, JE.VERSION
FROM BATCH_JOB_EXECUTION JE
	JOIN BATCH_STEP_EXECUTION SE ON SE.JOB_EXECUTION_ID = JE.JOB_EXECUTION_ID
WHERE JE.JOB_INSTANCE_ID = ? AND SE.STEP_NAME = ?
]
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Initiating transaction commit
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Committing JDBC transaction on Connection [HikariProxyConnection@41792607 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551]
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Releasing JDBC Connection [HikariProxyConnection@41792607 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] after transaction
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Creating new transaction with name [org.springframework.batch.core.repository.support.SimpleJobRepository.getStepExecutionCount]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Acquired Connection [HikariProxyConnection@2133629275 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] for JDBC transaction
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Switching JDBC Connection [HikariProxyConnection@2133629275 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to manual commit
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT COUNT(*)
FROM BATCH_JOB_EXECUTION JE
	JOIN BATCH_STEP_EXECUTION SE ON SE.JOB_EXECUTION_ID = JE.JOB_EXECUTION_ID
WHERE JE.JOB_INSTANCE_ID = ? AND SE.STEP_NAME = ?
]
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Initiating transaction commit
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Committing JDBC transaction on Connection [HikariProxyConnection@2133629275 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551]
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Releasing JDBC Connection [HikariProxyConnection@2133629275 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] after transaction
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Creating new transaction with name [org.springframework.batch.core.repository.support.SimpleJobRepository.add]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Acquired Connection [HikariProxyConnection@1060921037 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] for JDBC transaction
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Switching JDBC Connection [HikariProxyConnection@1060921037 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to manual commit
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL update
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [INSERT INTO BATCH_STEP_EXECUTION(STEP_EXECUTION_ID, VERSION, STEP_NAME, JOB_EXECUTION_ID, START_TIME, END_TIME, STATUS, COMMIT_COUNT, READ_COUNT, FILTER_COUNT, WRITE_COUNT, EXIT_CODE, EXIT_MESSAGE, READ_SKIP_COUNT, WRITE_SKIP_COUNT, PROCESS_SKIP_COUNT, ROLLBACK_COUNT, LAST_UPDATED, CREATE_TIME)
	VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
]
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL update
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [INSERT INTO BATCH_STEP_EXECUTION_CONTEXT (SHORT_CONTEXT, SERIALIZED_CONTEXT, STEP_EXECUTION_ID)
	VALUES(?, ?, ?)
]
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Initiating transaction commit
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Committing JDBC transaction on Connection [HikariProxyConnection@1060921037 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551]
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Releasing JDBC Connection [HikariProxyConnection@1060921037 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] after transaction
2025-02-07 08:33:33 INFO  o.s.batch.core.job.SimpleStepHandler - Executing step: [myStep]
2025-02-07 08:33:33 DEBUG o.s.batch.core.step.AbstractStep - Executing: id=2
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Creating new transaction with name [org.springframework.batch.core.repository.support.SimpleJobRepository.update]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Acquired Connection [HikariProxyConnection@22958662 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] for JDBC transaction
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Switching JDBC Connection [HikariProxyConnection@22958662 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to manual commit
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL update
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [UPDATE BATCH_STEP_EXECUTION
SET START_TIME = ?, END_TIME = ?, STATUS = ?, COMMIT_COUNT = ?, READ_COUNT = ?, FILTER_COUNT = ?, WRITE_COUNT = ?, EXIT_CODE = ?, EXIT_MESSAGE = ?, VERSION = ?, READ_SKIP_COUNT = ?, PROCESS_SKIP_COUNT = ?, WRITE_SKIP_COUNT = ?, ROLLBACK_COUNT = ?, LAST_UPDATED = ?
WHERE STEP_EXECUTION_ID = ? AND VERSION = ?
]
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT VERSION
FROM BATCH_JOB_EXECUTION
WHERE JOB_EXECUTION_ID=?
]
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Initiating transaction commit
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Committing JDBC transaction on Connection [HikariProxyConnection@22958662 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551]
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Releasing JDBC Connection [HikariProxyConnection@22958662 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] after transaction
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Creating new transaction with name [org.springframework.batch.core.repository.support.SimpleJobRepository.updateExecutionContext]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Acquired Connection [HikariProxyConnection@1663913202 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] for JDBC transaction
2025-02-07 08:33:33 DEBUG o.s.j.support.JdbcTransactionManager - Switching JDBC Connection [HikariProxyConnection@1663913202 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to manual commit
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL update
2025-02-07 08:33:33 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [UPDATE BATCH_STEP_EXECUTION_CONTEXT
SET SHORT_CONTEXT = ?, SERIALIZED_CONTEXT = ?
WHERE STEP_EXECUTION_ID = ?
]
2025-02-07 08:33:34 DEBUG o.s.j.support.JdbcTransactionManager - Initiating transaction commit
2025-02-07 08:33:34 DEBUG o.s.j.support.JdbcTransactionManager - Committing JDBC transaction on Connection [HikariProxyConnection@1663913202 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551]
2025-02-07 08:33:34 DEBUG o.s.j.support.JdbcTransactionManager - Releasing JDBC Connection [HikariProxyConnection@1663913202 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] after transaction
2025-02-07 08:33:34 DEBUG o.s.b.repeat.support.RepeatTemplate - Starting repeat context.
2025-02-07 08:33:34 DEBUG o.s.b.repeat.support.RepeatTemplate - Repeat operation about to start at count=1
2025-02-07 08:33:34 DEBUG o.s.b.c.s.c.StepContextRepeatCallback - Preparing chunk execution for StepContext: org.springframework.batch.core.scope.context.StepContext@2211b44f
2025-02-07 08:33:34 DEBUG o.s.b.c.s.c.StepContextRepeatCallback - Chunk execution starting: queue size=0
2025-02-07 08:33:34 DEBUG o.s.j.support.JdbcTransactionManager - Creating new transaction with name [null]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-02-07 08:33:34 DEBUG o.s.j.support.JdbcTransactionManager - Acquired Connection [HikariProxyConnection@433224743 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] for JDBC transaction
2025-02-07 08:33:34 DEBUG o.s.j.support.JdbcTransactionManager - Switching JDBC Connection [HikariProxyConnection@433224743 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to manual commit
2025-02-07 08:33:34 INFO  c.s.s.jobs.task01.GreetingTask - ------------------ Task Execute -----------------
2025-02-07 08:34:43 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1m10s156ms).
2025-02-07 08:34:43 INFO  c.s.s.jobs.task01.GreetingTask - GreetingTask: [StepContribution: read=0, written=0, filtered=0, readSkips=0, writeSkips=0, processSkips=0, exitStatus=EXECUTING], ChunkContext: attributes=[], complete=false, stepContext=SynchronizedAttributeAccessor: [], stepExecutionContext={batch.taskletType=com.schooldevops.spring_batch.jobs.task01.GreetingTask, batch.version=5.2.1, batch.stepType=org.springframework.batch.core.step.tasklet.TaskletStep}, jobExecutionContext={batch.version=5.2.1}, jobParameters={run.id=2}
2025-02-07 08:34:43 DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Pool stats (total=10/10, idle=9/10, active=1, waiting=0)
2025-02-07 08:34:43 DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled.
2025-02-07 08:34:43 DEBUG o.s.b.core.step.tasklet.TaskletStep - Applying contribution: [StepContribution: read=0, written=0, filtered=0, readSkips=0, writeSkips=0, processSkips=0, exitStatus=EXECUTING]
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Participating in existing transaction
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL update
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [UPDATE BATCH_STEP_EXECUTION_CONTEXT
SET SHORT_CONTEXT = ?, SERIALIZED_CONTEXT = ?
WHERE STEP_EXECUTION_ID = ?
]
2025-02-07 08:34:43 DEBUG o.s.b.core.step.tasklet.TaskletStep - Saving step execution before commit: StepExecution: id=2, version=1, name=myStep, status=STARTED, exitStatus=EXECUTING, readCount=0, filterCount=0, writeCount=0 readSkipCount=0, writeSkipCount=0, processSkipCount=0, commitCount=1, rollbackCount=0, exitDescription=
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Participating in existing transaction
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL update
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [UPDATE BATCH_STEP_EXECUTION
SET START_TIME = ?, END_TIME = ?, STATUS = ?, COMMIT_COUNT = ?, READ_COUNT = ?, FILTER_COUNT = ?, WRITE_COUNT = ?, EXIT_CODE = ?, EXIT_MESSAGE = ?, VERSION = ?, READ_SKIP_COUNT = ?, PROCESS_SKIP_COUNT = ?, WRITE_SKIP_COUNT = ?, ROLLBACK_COUNT = ?, LAST_UPDATED = ?
WHERE STEP_EXECUTION_ID = ? AND VERSION = ?
]
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT VERSION
FROM BATCH_JOB_EXECUTION
WHERE JOB_EXECUTION_ID=?
]
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Initiating transaction commit
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Committing JDBC transaction on Connection [HikariProxyConnection@433224743 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551]
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Releasing JDBC Connection [HikariProxyConnection@433224743 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] after transaction
2025-02-07 08:34:43 DEBUG o.s.b.repeat.support.RepeatTemplate - Repeat is complete according to policy and result value.
2025-02-07 08:34:43 DEBUG o.s.batch.core.step.AbstractStep - Step execution success: id=2
2025-02-07 08:34:43 INFO  o.s.batch.core.step.AbstractStep - Step: [myStep] executed in 1m9s711ms
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Creating new transaction with name [org.springframework.batch.core.repository.support.SimpleJobRepository.updateExecutionContext]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Acquired Connection [HikariProxyConnection@890181798 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] for JDBC transaction
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Switching JDBC Connection [HikariProxyConnection@890181798 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to manual commit
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL update
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [UPDATE BATCH_STEP_EXECUTION_CONTEXT
SET SHORT_CONTEXT = ?, SERIALIZED_CONTEXT = ?
WHERE STEP_EXECUTION_ID = ?
]
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Initiating transaction commit
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Committing JDBC transaction on Connection [HikariProxyConnection@890181798 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551]
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Releasing JDBC Connection [HikariProxyConnection@890181798 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] after transaction
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Creating new transaction with name [org.springframework.batch.core.repository.support.SimpleJobRepository.update]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Acquired Connection [HikariProxyConnection@1303849183 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] for JDBC transaction
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Switching JDBC Connection [HikariProxyConnection@1303849183 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to manual commit
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL update
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [UPDATE BATCH_STEP_EXECUTION
SET START_TIME = ?, END_TIME = ?, STATUS = ?, COMMIT_COUNT = ?, READ_COUNT = ?, FILTER_COUNT = ?, WRITE_COUNT = ?, EXIT_CODE = ?, EXIT_MESSAGE = ?, VERSION = ?, READ_SKIP_COUNT = ?, PROCESS_SKIP_COUNT = ?, WRITE_SKIP_COUNT = ?, ROLLBACK_COUNT = ?, LAST_UPDATED = ?
WHERE STEP_EXECUTION_ID = ? AND VERSION = ?
]
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT VERSION
FROM BATCH_JOB_EXECUTION
WHERE JOB_EXECUTION_ID=?
]
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Initiating transaction commit
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Committing JDBC transaction on Connection [HikariProxyConnection@1303849183 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551]
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Releasing JDBC Connection [HikariProxyConnection@1303849183 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] after transaction
2025-02-07 08:34:43 DEBUG o.s.batch.core.step.AbstractStep - Step execution complete: StepExecution: id=2, version=3, name=myStep, status=COMPLETED, exitStatus=COMPLETED, readCount=0, filterCount=0, writeCount=0 readSkipCount=0, writeSkipCount=0, processSkipCount=0, commitCount=1, rollbackCount=0
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Creating new transaction with name [org.springframework.batch.core.repository.support.SimpleJobRepository.updateExecutionContext]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Acquired Connection [HikariProxyConnection@1755687645 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] for JDBC transaction
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Switching JDBC Connection [HikariProxyConnection@1755687645 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to manual commit
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL update
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [UPDATE BATCH_JOB_EXECUTION_CONTEXT
SET SHORT_CONTEXT = ?, SERIALIZED_CONTEXT = ?
WHERE JOB_EXECUTION_ID = ?
]
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Initiating transaction commit
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Committing JDBC transaction on Connection [HikariProxyConnection@1755687645 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551]
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Releasing JDBC Connection [HikariProxyConnection@1755687645 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] after transaction
2025-02-07 08:34:43 DEBUG o.s.batch.core.job.AbstractJob - Upgrading JobExecution status: StepExecution: id=2, version=3, name=myStep, status=COMPLETED, exitStatus=COMPLETED, readCount=0, filterCount=0, writeCount=0 readSkipCount=0, writeSkipCount=0, processSkipCount=0, commitCount=1, rollbackCount=0, exitDescription=
2025-02-07 08:34:43 DEBUG o.s.batch.core.job.AbstractJob - Job execution complete: JobExecution: id=2, version=1, startTime=2025-02-07T08:33:33.967005, endTime=null, lastUpdated=2025-02-07T08:33:33.967900, status=COMPLETED, exitStatus=exitCode=COMPLETED;exitDescription=, job=[JobInstance: id=2, version=0, Job=[MY_JOB]], jobParameters=[{'run.id':'{value=2, type=class java.lang.Long, identifying=true}'}]
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Creating new transaction with name [org.springframework.batch.core.repository.support.SimpleJobRepository.update]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Acquired Connection [HikariProxyConnection@1912308481 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] for JDBC transaction
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Switching JDBC Connection [HikariProxyConnection@1912308481 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] to manual commit
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT VERSION
FROM BATCH_JOB_EXECUTION
WHERE JOB_EXECUTION_ID=?
]
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL query
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [SELECT COUNT(*)
FROM BATCH_JOB_EXECUTION
WHERE JOB_EXECUTION_ID = ?
]
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL update
2025-02-07 08:34:43 DEBUG o.s.jdbc.core.JdbcTemplate - Executing prepared SQL statement [UPDATE BATCH_JOB_EXECUTION
SET START_TIME = ?, END_TIME = ?,  STATUS = ?, EXIT_CODE = ?, EXIT_MESSAGE = ?, VERSION = ?, CREATE_TIME = ?, LAST_UPDATED = ?
WHERE JOB_EXECUTION_ID = ? AND VERSION = ?
]
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Initiating transaction commit
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Committing JDBC transaction on Connection [HikariProxyConnection@1912308481 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551]
2025-02-07 08:34:43 DEBUG o.s.j.support.JdbcTransactionManager - Releasing JDBC Connection [HikariProxyConnection@1912308481 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cc2c551] after transaction
2025-02-07 08:34:43 INFO  o.s.b.c.l.s.TaskExecutorJobLauncher - Job: [SimpleJob: [name=MY_JOB]] completed with the following parameters: [{'run.id':'{value=2, type=class java.lang.Long, identifying=true}'}] and the following status: [COMPLETED] in 1m9s751ms
2025-02-07 08:34:43 DEBUG o.s.b.a.ApplicationAvailabilityBean - Application availability state ReadinessState changed to ACCEPTING_TRAFFIC
2025-02-07 08:34:43 DEBUG o.s.c.a.AnnotationConfigApplicationContext - Closing org.springframework.context.annotation.AnnotationConfigApplicationContext@304b9f1a, started on Fri Feb 07 08:33:32 KST 2025
2025-02-07 08:34:43 DEBUG o.s.c.s.DefaultLifecycleProcessor - Stopping beans in phase 1073741823
2025-02-07 08:34:43 DEBUG o.s.c.s.DefaultLifecycleProcessor - Bean 'applicationTaskExecutor' completed its stop procedure
2025-02-07 08:34:43 DEBUG o.s.c.s.DefaultLifecycleProcessor - Stopping beans in phase -2147483647
2025-02-07 08:34:43 DEBUG o.s.c.s.DefaultLifecycleProcessor - Bean 'springBootLoggingLifecycle' completed its stop procedure
2025-02-07 08:34:43 DEBUG o.s.s.c.ThreadPoolTaskExecutor - Shutting down ExecutorService 'applicationTaskExecutor'
2025-02-07 08:34:43 DEBUG o.s.b.c.c.s.JobRegistrySmartInitializingSingleton - Unregistering job: MY_JOB
2025-02-07 08:34:43 DEBUG o.s.j.e.a.AnnotationMBeanExporter - Unregistering JMX-exposed beans on shutdown
2025-02-07 08:34:43 DEBUG o.s.j.e.a.AnnotationMBeanExporter - Unregistering JMX-exposed beans
2025-02-07 08:34:43 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-02-07 08:34:43 DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Before shutdown stats (total=10/10, idle=10/10, active=0, waiting=0)
2025-02-07 08:34:43 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@7cc2c551: (connection evicted)
2025-02-07 08:34:43 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@32f28171: (connection evicted)
2025-02-07 08:34:43 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@5d8a653a: (connection evicted)
2025-02-07 08:34:43 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@58bedc17: (connection evicted)
2025-02-07 08:34:43 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@7b9e546f: (connection evicted)
2025-02-07 08:34:43 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@372850: (connection evicted)
2025-02-07 08:34:43 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@27930f57: (connection evicted)
2025-02-07 08:34:43 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@5b114d23: (connection evicted)
2025-02-07 08:34:43 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@e628946: (connection evicted)
2025-02-07 08:34:43 DEBUG com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@4b674abf: (connection evicted)
2025-02-07 08:34:43 DEBUG com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - After shutdown stats (total=0/10, idle=0/10, active=0, waiting=0)
2025-02-07 08:34:43 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
Disconnected from the target VM, address: '127.0.0.1:59067', transport: 'socket'

Process finished with exit code 0
```

- 우리가 원하는 afterPropertySet(), Job, Step, Tasklet 순으로 실행됨을 알 수다. 

## 참고

- 배치 실행이 정상동작 하지 않을때 

1. SpringBatchApplication.kt 파일에서 @EnableBatchProcessing 어노테이션을 제거한다. 
2. application.yaml 파일 내부를 변경한다.
```kt
spring:
  batch:
    jdbc:
      initialize-schema: always
```


## WrapUp

- 지금까지 간단한 Batch 를 생성하고 실행해 보았다. 
- 나중에 더 자세하게 알아볼 것이지만 테스크릿으로 배치를 수행하는 방법도 알아 보았다. 
- 특별한 설정없이 우리는 스프링배치를 뚝딱 만들었고 몇가지 구조 JobRepository, Job, Step, Tasket 등이 있음을 알게 되었다. 

